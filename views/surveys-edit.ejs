<%- include("partials/header") %>
<%- include("partials/nav") %>

<h1 class="section-header"><%= mode === "edit" ? "Edit Survey" : "Add Survey" %></h1>

<div class="card">

    <form action="/surveys/save" method="POST" class="form-layout">

        <% if (mode === "edit") { %>
            <input type="hidden" name="SurveyID" value="<%= survey.SurveyID %>">
        <% } %>

        <div class="form-group">
            <label>Participant Email</label>
            <input type="email" name="ParticipantEmail"
                   value="<%= survey ? survey.ParticipantEmail : '' %>" required>
        </div>

        <div class="form-group">
            <label>Event Name</label>
            <input type="text" name="EventName"
                   value="<%= survey ? survey.EventName : '' %>" required>
        </div>

        <div class="form-group">
            <label>Event Start (Date/Time)</label>
            <input 
  type="datetime-local" 
  name="EventDateTimeStart"
  value="<%= survey ? survey.EventDateTimeStart.replace(/[:T]/g, '').replace(/(\d{4}-\d{2}-\d{2})(\d{2})(\d{2})?/, '$1$2$3') : '' %>"
  step="60"
  required>

        </div>
        

        <div class="form-group">
            <label>Satisfaction Score</label>
            <input type="number" class="decimal-input" name="SurveySatisfactionScore" max="5" step="0.1"
                   value="<%= survey ? Number(survey.SurveySatisfactionScore).toFixed(1) : '' %>"
                   onchange="if(this.value) this.value = parseFloat(this.value).toFixed(1);">
        </div>

        <div class="form-group">
            <label>Usefulness Score</label>
            <input type="number" class="decimal-input" name="SurveyUsefulnessScore" max="5" step="0.1"
                   value="<%= survey ? Number(survey.SurveyUsefulnessScore).toFixed(1) : '' %>"
                   onchange="if(this.value) this.value = parseFloat(this.value).toFixed(1);">
                   
        </div>

        <div class="form-group">
            <label>Instructor Score</label>
            <input type="number" class="decimal-input" name="SurveyInstructorScore" max="5" step="0.1"
                   value="<%= survey ? Number(survey.SurveyInstructorScore).toFixed(1) : '' %>"
                   onchange="if(this.value) this.value = parseFloat(this.value).toFixed(1);">
        </div>

        <div class="form-group">
            <label>Recommendation Score</label>
            <input type="number" class="decimal-input" name="SurveyRecommendationScore" max="5" step="0.1"
                   value="<%= survey ? Number(survey.SurveyRecommendationScore).toFixed(1) : '' %>"
                   onchange="if(this.value) this.value = parseFloat(this.value).toFixed(1);">
        </div>

        <div class="form-group">
            <label>Overall Score</label>
            <input type="number" class="decimal-input" name="SurveyOverallScore" max="5" step="0.1"
                   value="<%= survey ? Number(survey.SurveyOverallScore).toFixed(1) : '' %>"
                   onchange="if(this.value) this.value = parseFloat(this.value).toFixed(1);">
        </div>

        <div class="form-group">
            <label>NPS Bucket</label>
            <select name="SurveyNPSBucket">
                <option value="Promoter" <%= survey && survey.SurveyNPSBucket === 'Promoter' ? 'selected' : '' %>>Promoter</option>
                <option value="Passive" <%= survey && survey.SurveyNPSBucket === 'Passive' ? 'selected' : '' %>>Passive</option>
                <option value="Detractor" <%= survey && survey.SurveyNPSBucket === 'Detractor' ? 'selected' : '' %>>Detractor</option>
            </select>
        </div>
        

        <div class="form-group">
            <label>Comments</label>
            <textarea name="SurveyComments"><%= survey ? survey.SurveyComments : '' %></textarea>
        </div>

        <div class="form-actions">
            <button class="btn btn-primary">
                <%= mode === "edit" ? "Save" : "Add Survey" %>
            </button>
            <a class="btn btn-secondary" href="/surveys">Cancel</a>
        </div>

    </form>
</div>

<%- include("partials/footer") %>
