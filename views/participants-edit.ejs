<%- include("partials/header") %>
<%- include("partials/nav") %>

<h1 class="section-header">
    <%= mode === "edit" ? "Edit Participant" : "Add Participant" %>
</h1>

<div class="card">

    <form action="/participants/save" method="POST" class="form-layout">

        <% if (mode === "edit") { %>
            <input type="hidden" name="OriginalEmail" value="<%= participant.ParticipantEmail %>">
        <% } %>

        <!-- EMAIL --------------------------------------------------------- -->
        <div class="form-group">
            <label>Email <span class="required">*</span></label>
            <input type="email"
                   name="ParticipantEmail"
                   required
                   placeholder="email@example.com"
                   value="<%= participant ? participant.ParticipantEmail : '' %>">
        </div>

        <!-- FIRST NAME ----------------------------------------------------- -->
        <div class="form-group">
            <label>First Name <span class="required">*</span></label>
            <input type="text"
                   name="ParticipantFirstName"
                   required
                   placeholder="First name"
                   value="<%= participant ? participant.ParticipantFirstName : '' %>">
        </div>

        <!-- LAST NAME ------------------------------------------------------ -->
        <div class="form-group">
            <label>Last Name <span class="required">*</span></label>
            <input type="text"
                   name="ParticipantLastName"
                   required
                   placeholder="Last name"
                   value="<%= participant ? participant.ParticipantLastName : '' %>">
        </div>

        <!-- DOB ------------------------------------------------------------ -->
        <% 
            let formattedDOB = "";
            if (participant && participant.ParticipantDOB) {
                try {
                    formattedDOB = new Date(participant.ParticipantDOB).toISOString().split("T")[0];
                } catch (e) {}
            }
        %>

        <div class="form-group">
            <label>Date of Birth</label>
            <input type="date"
                   name="ParticipantDOB"
                   value="<%= formattedDOB %>">
        </div>

        <!-- ROLE ----------------------------------------------------------- -->
        <div class="form-group">
            <label>Role</label>
            <select name="ParticipantRole">
                <option value="">-- Select Role --</option>
                <option value="participant" <%= participant && participant.ParticipantRole === "participant" ? "selected" : "" %>>Participant</option>
                <option value="admin" <%= participant && participant.ParticipantRole === "admin" ? "selected" : "" %>>admin</option>
            </select>
        </div>

        <!-- PHONE ---------------------------------------------------------- -->
        <div class="form-group">
            <label>Phone</label>
            <input type="tel"
                   name="ParticipantPhone"
                   placeholder="###-###-####"
                   value="<%= participant ? participant.ParticipantPhone : '' %>">
        </div>

        <!-- CITY ----------------------------------------------------------- -->
        <div class="form-group">
            <label>City</label>
            <input type="text"
                   name="ParticipantCity"
                   placeholder="City"
                   value="<%= participant ? participant.ParticipantCity : '' %>">
        </div>

        <!-- STATE ---------------------------------------------------------- -->
        <div class="form-group">
            <label>State</label>
            <select name="ParticipantState">
                <option value="">-- Select State --</option>
                <% 
                    const states = ["UT","CA","AZ","NV","CO","ID","WA","OR","NM","TX","Other"];
                    states.forEach(s => { 
                %>
                    <option value="<%= s %>" <%= participant && participant.ParticipantState === s ? "selected" : "" %>><%= s %></option>
                <% }) %>
            </select>
        </div>

        <!-- ZIP ------------------------------------------------------------ -->
        <div class="form-group">
            <label>Zip</label>
            <input type="text"
                   name="ParticipantZip"
                   placeholder="Zip code"
                   maxlength="10"
                   value="<%= participant ? participant.ParticipantZip : '' %>">
        </div>

        <!-- ACTIONS -------------------------------------------------------- -->
        <div class="form-actions">
            <button class="btn btn-primary" type="submit">
                <%= mode === "edit" ? "Save Changes" : "Add Participant" %>
            </button>

            <a class="btn btn-secondary" href="/participants">Cancel</a>
        </div>

    </form>

</div>

<%- include("partials/footer") %>

<style>
    .required {
        color: red;
        font-weight: bold;
    }
</style>
