<%- include("partials/header") %>
<%- include("partials/nav") %>

<div class="page-header">
    <h1 class="section-header">Surveys</h1>

    <% if (user && user.level === "M") { %>
        <a class="btn btn-primary add-btn" href="/surveys/edit">Add Survey</a>
    <% } %>
</div>

<div class="search-bar">
    <form method="GET" action="/donations" class="search-bar">
        <input type="text" name="search" placeholder="Search..." value="<%= search %>">
        <button class="btn btn-primary" type="submit">Search</button>
        <a class="btn btn-secondary" href="<%= clearPath %>">Clear</a>
    </form>
</div>

<div class="card">
    <table class="styled-table">
        <thead>
            <tr>
                <th>Email</th>
                <th>Event</th>
                <th>Start</th>
                <th>NPS</th>
                <th>Comments</th>

                <% if (user && user.level === "M") { %>
                    <th class="actions-header">Actions</th>
                <% } %>
            </tr>
        </thead>

        <tbody>
            <% surveys.forEach(s => { %>
                <tr>
                    <td><%= s.ParticipantEmail %></td>
                    <td><%= s.EventName %></td>
                    <td><%= s.EventDateTimeStart %></td>
                    <td><%= s.SurveyNPSBucket %></td>
                    <td><%= s.SurveyComments %></td>

                    <% if (user && user.level === "M") { %>
                        <td class="action-buttons">
                            <a class="btn btn-secondary btn-sm" href="/surveys/edit/<%= s.SurveyID %>">Edit</a>

                            <form method="POST" action="/surveys/delete/<%= s.SurveyID %>" class="inline-form">
                                <button class="btn btn-danger btn-sm">Delete</button>
                            </form>
                        </td>
                    <% } %>
                </tr>
            <% }) %>
        </tbody>
    </table>
</div>
